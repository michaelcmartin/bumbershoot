pico-8 cartridge // http://www.pico-8.com
version 43
__lua__
-- lights out!
-- bumbershoot software, 2025

--[[
 game states:
 0: waiting to start (init/win)
 1-31: mid-rando (counts up)
 32: playing
 33-39: move anim (counts down)
]]

function _init()
  board={}
  for y=1,5 do
    board[y]={0,0,0,0,0}
  end
  state=0
  status1={"\fawelcome!",-2}
  status2={"\f7press üÖæÔ∏è to start",-1}
  cursx=-1
  cursy=-1
  menuitem(1|0x300,"new puzzle",function() state=1 end)
end

function new_puzzle()
  for y=1,5 do
    for x=1,5 do
      if (rnd()<.5) make_move(x,y)
    end
  end
end

function won_game()
  for y=1,5 do
    for x=1,5 do
      if (board[y][x]==1) return false
    end
  end
  return true
end

function make_move(x,y)
  board[y][x]=1-board[y][x]
  if (x>1) board[y][x-1]=1-board[y][x-1]
  if (x<5) board[y][x+1]=1-board[y][x+1]
  if (y>1) board[y-1][x]=1-board[y-1][x]
  if (y<5) board[y+1][x]=1-board[y+1][x]
end  

function _draw()
  cls()
  palt(0,false)
  palt(1,true)
  map(0,0,0,0,16,16)
  for y=1,5 do
    for x=1,5 do
      if board[y][x] != 0 then
        spr(34,x*16+8,y*16+16,2,2)
      end
    end
  end
  local delta=0
  if state>32 then
    local pushed=36
    delta=1
    if (board[cursy][cursx] != 0) pushed=38
    spr(pushed,cursx*16+8,cursy*16+16,2,2)
  end
  if cursx > 0 then
    spr(44,cursx*16+16-delta,cursy*16+24+delta,1,2)
  end
  if (status1) print(status1[1],64-2*(#status1[1]+status1[2]),19)
  if (status2) print(status2[1],64-2*(#status2[1]+status2[2]),120)
end

function _update()
  if state==0 then
    cursx=-1
    if (btnp(üÖæÔ∏è)) state=1
  elseif state<32 then
    status1={"\fbrandomizing...",-2}
    status2=nil
    new_puzzle()
    cursx=-1
    state+=1
    if state==32 then
      cursx=3
      cursy=3
    end
  elseif state>32 then
    state-=1
    if state==32 and won_game() then
      status1={"\facongratulations!",-2}
      status2={"\f7press üÖæÔ∏è to play again",-1}
      state=0
      cursx=-1
    end
  else
    status1=nil
    status2={"\f7d-pad to move,üÖæÔ∏è/‚ùé to flip",-2}
    if (btnp(‚¨ÖÔ∏è) and cursx>1) cursx-=1
    if (btnp(‚û°Ô∏è) and cursx<5) cursx+=1
    if (btnp(‚¨ÜÔ∏è) and cursy>1) cursy-=1
    if (btnp(‚¨áÔ∏è) and cursy<5) cursy+=1
    if btnp(‚ùé) or btnp(üÖæÔ∏è) then
      make_move(cursx,cursy)
      if won_game() then
        music(0)
      else
        if board[cursy][cursx]>0 then sfx(2) else sfx(1) end
      end
      state=39
    end
  end
end
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000777770000777700777707007770077770777777700077707000000077770007777077707777777707700000000000000000000000
00000000000000000000000077000000077007700077000700007700700700700770077000000770077000777000707007700707700000000000000000000000
00000000000000000000000770000000070077000070000700007000000700000770007000007700007700070000700000700000770000000000000000000000
00000000000000000000000770000000770077000000000700007000000700000777000000007700000770070000770000770000770000000000000000000000
00000000000000000000007700000000700770000000007777777000000700000077700000007700000770077000070000770000007000000000000000000000
00000000000000000000007700000000700770000000007000007000007700000007770000007700000770077000070000070000007000000000000000000000
00000000000000000000077000070007700770007770077000007000007700000000777000000770000077007000070000077000000700000000000000000000
00000000000000000000077000770007000770000700077000077000007700000700077000000770000077007000077000007000000000000000000000000000
00000000000000000000770007700077000770007700077000077000007700000770077000000077000770007700077000007700000770000000000000000000
00000000000000000007777777700777700077777000777700777700077770000707770000000007777700000777770000077770000770000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07070707777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777707070707
70707070777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777770707070
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666666666666666666666666666666666666666666666666666666661111111111111111111111116666111101111111000000000000000000000000
66600000000000666668888888888866666666666666666666666666666666661111111111111111111111116666111100111111000000000000000000000000
66000000000000066688888888888886660000000000066666888888888886661111111111111111111111116666111107011111000000000000000000000000
65000000000000066588888888888886600000000000006668888888888888661111111111111111111111116666111107701111000000000000000000000000
65000000000000066588888888888886600000000000006668888888888888661111166666611111666666666666111107770111000000000000000000000000
65000000000000066588888888888886600000000000006668888888888888661111666666661111666666666666111107777011000000000000000000000000
65000000000000066588888888888886600000000000006668888888888888661115665665661111666666666666111107777701000000000000000000000000
65000000000000066588888888888886600000000000006668888888888888661115666666661111666666666666111107777770000000000000000000000000
65000000000000066588888888888886600000000000006668888888888888661115666666661111666666661115666607777001000000000000000000000000
65000000000000066588888888888886600000000000006668888888888888661115665665661111666666661115666607707011000000000000000000000000
65000000000000066588888888888886600000000000006668888888888888661115666666661111666666661115666607010701000000000000000000000000
65000000000000066588888888888886600000000000006668888888888888661115566666611111666666661115666600110701000000000000000000000000
65000000000000066588888888888886600000000000006668888888888888661111555555111111555555551115666611111070000000000000000000000000
65500000000000666558888888888866600000000000006668888888888888661111111111111111111111111115666611111070000000000000000000000000
66555555555556666655555555555666660000000000066666888888888886661111111111111111111111111115666611111101000000000000000000000000
66666666666666666666666666666666666666666666666666666666666666661111111111111111111111111115666611111111000000000000000000000000
__label__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000777770000777700777707007770077770777777700077707000000077770007777077707777777707700000000000000000000000
00000000000000000000000077000000077007700077000700007700700700700770077000000770077000777000707007700707700000000000000000000000
00000000000000000000000770000000070077000070000700007000000700000770007000007700007700070000700000700000770000000000000000000000
00000000000000000000000770000000770077000000000700007000000700000777000000007700000770070000770000770000770000000000000000000000
00000000000000000000007700000000700770000000007777777000000700000077700000007700000770077000070000770000007000000000000000000000
00000000000000000000007700000000700770000000007000007000007700000007770000007700000770077000070000070000007000000000000000000000
00000000000000000000077000070007700770007770077000007000007700000000777000000770000077007000070000077000000700000000000000000000
00000000000000000000077000770007000770000700077000077000007700000700077000000770000077007000077000007000000000000000000000000000
00000000000000000000770007700077000770007700077000077000007700000770077000000077000770007700077000007700000770000000000000000000
00000000000000000007777777700777700077777000777700777700077770000707770000000007777700000777770000077770000770000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07070707777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777707070707
70707070777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777770707070
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000066666666666666666666666666666666666666666666666666666666666666666666666666666666666666000000000000000000000
00000000000000000000666666666666666666666666666666666666666666666666666666666666666666666666666666666666666600000000000000000000
00000000000000000005665666666666666666666666666666666666666666666666666666666666666666666666666666666666656600000000000000000000
00000000000000000005666666666666666666666666666666666666666666666666666666666666666666666666666666666666666600000000000000000000
00000000000000000005666666666666666666666666666666666666666666666666666666666666666666666666666666666666666600000000000000000000
00000000000000000005666666600000000000666660000000000066666888888888886666600000000000666660000000000066666600000000000000000000
00000000000000000005666666000000000000066600000000000006668888888888888666000000000000066600000000000006666600000000000000000000
00000000000000000005666665000000000000066500000000000006658888888888888665000000000000066500000000000006666600000000000000000000
00000000000000000005666665000000000000066500000000000006658888888888888665000000000000066500000000000006666600000000000000000000
00000000000000000005666665000000000000066500000000000006658888888888888665000000000000066500000000000006666600000000000000000000
00000000000000000005666665000000000000066500000000000006658888888888888665000000000000066500000000000006666600000000000000000000
00000000000000000005666665000000000000066500000000000006658888888888888665000000000000066500000000000006666600000000000000000000
00000000000000000005666665000000000000066500000000000006658888888888888665000000000000066500000000000006666600000000000000000000
00000000000000000005666665000000000000066500000000000006658888888888888665000000000000066500000000000006666600000000000000000000
00000000000000000005666665000000000000066500000000000006658888888888888665000000000000066500000000000006666600000000000000000000
00000000000000000005666665000000000000066500000000000006658888888888888665000000000000066500000000000006666600000000000000000000
00000000000000000005666665000000000000066500000000000006658888888888888665000000000000066500000000000006666600000000000000000000
00000000000000000005666665500000000000666550000000000066655888888888886665500000000000666550000000000066666600000000000000000000
00000000000000000005666666555555555556666655555555555666665555555555566666555555555556666655555555555666666600000000000000000000
00000000000000000005666666666666666666666666666666666666666666666666666666666666666666666666666666666666666600000000000000000000
00000000000000000005666666666666666666666666666666666666666666666666666666666666666666666666666666666666666600000000000000000000
00000000000000000005666666600000000000666668888888888866666000000000006666688888888888666660000000000066666600000000000000000000
00000000000000000005666666000000000000066688888888888886660000000000000666888888888888866600000000000006666600000000000000000000
00000000000000000005666665000000000000066588888888888886650000000000000665888888888888866500000000000006666600000000000000000000
00000000000000000005666665000000000000066588888888888886650000000000000665888888888888866500000000000006666600000000000000000000
00000000000000000005666665000000000000066588888888888886650000000000000665888888888888866500000000000006666600000000000000000000
00000000000000000005666665000000000000066588888888888886650000000000000665888888888888866500000000000006666600000000000000000000
00000000000000000005666665000000000000066588888888888886650000000000000665888888888888866500000000000006666600000000000000000000
00000000000000000005666665000000000000066588888888888886650000000000000665888888888888866500000000000006666600000000000000000000
00000000000000000005666665000000000000066588888888888886650000000000000665888888888888866500000000000006666600000000000000000000
00000000000000000005666665000000000000066588888888888886650000000000000665888888888888866500000000000006666600000000000000000000
00000000000000000005666665000000000000066588888888888886650000000000000665888888888888866500000000000006666600000000000000000000
00000000000000000005666665000000000000066588888888888886650000000000000665888888888888866500000000000006666600000000000000000000
00000000000000000005666665500000000000666558888888888866655000000000006665588888888888666550000000000066666600000000000000000000
00000000000000000005666666555555555556666655555555555666665555555555566666555555555556666655555555555666666600000000000000000000
00000000000000000005666666666666666666666666666666666666666666666666666666666666666666666666666666666666666600000000000000000000
00000000000000000005666666666666666666666666666666666666666666666666666666666666666666666666666666666666666600000000000000000000
00000000000000000005666666688888888888666660000000000066666000000000006666600000000000666668888888888866666600000000000000000000
00000000000000000005666666888888888888866600000000000006660000000000000666000000000000066688888888888886666600000000000000000000
00000000000000000005666665888888888888866500000000000006650000000000000665000000000000066588888888888886666600000000000000000000
00000000000000000005666665888888888888866500000000000006650000000000000665000000000000066588888888888886666600000000000000000000
00000000000000000005666665888888888888866500000000000006650000000000000665000000000000066588888888888886666600000000000000000000
00000000000000000005666665888888888888866500000000000006650000000000000665000000000000066588888888888886666600000000000000000000
00000000000000000005666665888888888888866500000000000006650000000000000665000000000000066588888888888886666600000000000000000000
00000000000000000005666665888888888888866500000000000006650000000000000665000000000000066588888888888886666600000000000000000000
00000000000000000005666665888888888888866500000000000006650000000000000665000000000000066588888888888886666600000000000000000000
00000000000000000005666665888888888888866500000000000006650000000700000665000000000000066588888888888886666600000000000000000000
00000000000000000005666665888888888888866500000000000006650000000770000665000000000000066588888888888886666600000000000000000000
00000000000000000005666665888888888888866500000000000006650000000777000665000000000000066588888888888886666600000000000000000000
00000000000000000005666665588888888888666550000000000066655000000777706665500000000000666558888888888866666600000000000000000000
00000000000000000005666666555555555556666655555555555666665555550777770666555555555556666655555555555666666600000000000000000000
00000000000000000005666666666666666666666666666666666666666666660777777066666666666666666666666666666666666600000000000000000000
00000000000000000005666666666666666666666666666666666666666666660777700666666666666666666666666666666666666600000000000000000000
00000000000000000005666666600000000000666668888888888866666000000770706666688888888888666660000000000066666600000000000000000000
00000000000000000005666666000000000000066688888888888886660000000700070666888888888888866600000000000006666600000000000000000000
00000000000000000005666665000000000000066588888888888886650000000000070665888888888888866500000000000006666600000000000000000000
00000000000000000005666665000000000000066588888888888886650000000000007065888888888888866500000000000006666600000000000000000000
00000000000000000005666665000000000000066588888888888886650000000000007065888888888888866500000000000006666600000000000000000000
00000000000000000005666665000000000000066588888888888886650000000000000665888888888888866500000000000006666600000000000000000000
00000000000000000005666665000000000000066588888888888886650000000000000665888888888888866500000000000006666600000000000000000000
00000000000000000005666665000000000000066588888888888886650000000000000665888888888888866500000000000006666600000000000000000000
00000000000000000005666665000000000000066588888888888886650000000000000665888888888888866500000000000006666600000000000000000000
00000000000000000005666665000000000000066588888888888886650000000000000665888888888888866500000000000006666600000000000000000000
00000000000000000005666665000000000000066588888888888886650000000000000665888888888888866500000000000006666600000000000000000000
00000000000000000005666665000000000000066588888888888886650000000000000665888888888888866500000000000006666600000000000000000000
00000000000000000005666665500000000000666558888888888866655000000000006665588888888888666550000000000066666600000000000000000000
00000000000000000005666666555555555556666655555555555666665555555555566666555555555556666655555555555666666600000000000000000000
00000000000000000005666666666666666666666666666666666666666666666666666666666666666666666666666666666666666600000000000000000000
00000000000000000005666666666666666666666666666666666666666666666666666666666666666666666666666666666666666600000000000000000000
00000000000000000005666666600000000000666660000000000066666888888888886666600000000000666660000000000066666600000000000000000000
00000000000000000005666666000000000000066600000000000006668888888888888666000000000000066600000000000006666600000000000000000000
00000000000000000005666665000000000000066500000000000006658888888888888665000000000000066500000000000006666600000000000000000000
00000000000000000005666665000000000000066500000000000006658888888888888665000000000000066500000000000006666600000000000000000000
00000000000000000005666665000000000000066500000000000006658888888888888665000000000000066500000000000006666600000000000000000000
00000000000000000005666665000000000000066500000000000006658888888888888665000000000000066500000000000006666600000000000000000000
00000000000000000005666665000000000000066500000000000006658888888888888665000000000000066500000000000006666600000000000000000000
00000000000000000005666665000000000000066500000000000006658888888888888665000000000000066500000000000006666600000000000000000000
00000000000000000005666665000000000000066500000000000006658888888888888665000000000000066500000000000006666600000000000000000000
00000000000000000005666665000000000000066500000000000006658888888888888665000000000000066500000000000006666600000000000000000000
00000000000000000005666665000000000000066500000000000006658888888888888665000000000000066500000000000006666600000000000000000000
00000000000000000005666665000000000000066500000000000006658888888888888665000000000000066500000000000006666600000000000000000000
00000000000000000005666665500000000000666550000000000066655888888888886665500000000000666550000000000066666600000000000000000000
00000000000000000005666666555555555556666655555555555666665555555555566666555555555556666655555555555666666600000000000000000000
00000000000000000005666666666666666666666666666666666666666666666666666666666666666666666666666666666666666600000000000000000000
00000000000000000005666666666666666666666666666666666666666666666666666666666666666666666666666666666666666600000000000000000000
00000000000000000005665666666666666666666666666666666666666666666666666666666666666666666666666666666666656600000000000000000000
00000000000000000005666666666666666666666666666666666666666666666666666666666666666666666666666666666666666600000000000000000000
00000000000000000005566666666666666666666666666666666666666666666666666666666666666666666666666666666666666000000000000000000000
00000000000000000000555555555555555555555555555555555555555555555555555555555555555555555555555555555555550000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

__map__
000002030405060708090a0b0c0d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
101112131415161718191a1b1c1d1e1f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000282a2a2a2a2a2a2a2a2a2a29000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00003b202120212021202120212b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00003b303130313031303130312b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00003b202120212021202120212b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00003b303130313031303130312b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00003b202120212021202120212b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00003b303130313031303130312b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00003b202120212021202120212b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00003b303130313031303130312b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00003b202120212021202120212b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00003b303130313031303130312b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000383a3a3a3a3a3a3a3a3a3a39000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
010a00000030000300003000030000300003000030000300003000030000300003000030000300003000030000000000000000000000000000000000000000000000000000000000000000000000000000000000
011000001835018355000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
011000002435024355000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
010800003035030355000003035030350303503035030350303403033030320303103030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
010800002835028355000002835028350283502835028350283402833028320283102830028300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__music__
04 04034344

